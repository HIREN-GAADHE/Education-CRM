"""add_is_passed_and_rank_to_exam_results

Revision ID: d749cb483cbf
Revises: f848fd52f4f8
Create Date: 2026-02-07 05:32:00.608786+00:00

"""
from typing import Sequence, Union

from alembic import op
import sqlalchemy as sa
from sqlalchemy.dialects import postgresql

# revision identifiers, used by Alembic.
revision: str = 'd749cb483cbf'
down_revision: Union[str, None] = 'f848fd52f4f8'
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_index('ix_certificate_templates_certificate_type', table_name='certificate_templates')
    op.drop_index('ix_certificate_templates_code', table_name='certificate_templates')
    op.drop_index('ix_certificate_templates_tenant_id', table_name='certificate_templates')
    op.drop_table('certificate_templates')
    op.drop_index('ix_library_book_issues_tenant_id', table_name='library_book_issues')
    op.drop_table('library_book_issues')
    op.drop_index('ix_certificates_certificate_number', table_name='certificates')
    op.drop_index('ix_certificates_certificate_type', table_name='certificates')
    op.drop_index('ix_certificates_status', table_name='certificates')
    op.drop_index('ix_certificates_student_id', table_name='certificates')
    op.drop_index('ix_certificates_tenant_id', table_name='certificates')
    op.drop_index('ix_certificates_verification_code', table_name='certificates')
    op.drop_table('certificates')
    op.drop_index('ix_audit_logs_action', table_name='audit_logs')
    op.drop_index('ix_audit_logs_resource_id', table_name='audit_logs')
    op.drop_index('ix_audit_logs_resource_type', table_name='audit_logs')
    op.drop_index('ix_audit_logs_tenant_id', table_name='audit_logs')
    op.drop_index('ix_audit_logs_timestamp', table_name='audit_logs')
    op.drop_index('ix_audit_logs_user_id', table_name='audit_logs')
    op.drop_table('audit_logs')
    op.drop_index('ix_library_members_member_code', table_name='library_members')
    op.drop_index('ix_library_members_tenant_id', table_name='library_members')
    op.drop_table('library_members')
    op.drop_index('ix_hostel_room_allocations_tenant_id', table_name='hostel_room_allocations')
    op.drop_table('hostel_room_allocations')
    op.drop_index('ix_hostels_code', table_name='hostels')
    op.drop_index('ix_hostels_tenant_id', table_name='hostels')
    op.drop_table('hostels')
    op.drop_index('ix_library_books_accession_number', table_name='library_books')
    op.drop_index('ix_library_books_author', table_name='library_books')
    op.drop_index('ix_library_books_isbn', table_name='library_books')
    op.drop_index('ix_library_books_isbn13', table_name='library_books')
    op.drop_index('ix_library_books_tenant_id', table_name='library_books')
    op.drop_index('ix_library_books_title', table_name='library_books')
    op.drop_table('library_books')
    op.drop_index('ix_hostel_beds_tenant_id', table_name='hostel_beds')
    op.drop_table('hostel_beds')
    op.drop_index('ix_library_settings_tenant_id', table_name='library_settings')
    op.drop_table('library_settings')
    op.drop_index('ix_library_book_copies_barcode', table_name='library_book_copies')
    op.drop_index('ix_library_book_copies_tenant_id', table_name='library_book_copies')
    op.drop_table('library_book_copies')
    op.drop_index('ix_hostel_fees_tenant_id', table_name='hostel_fees')
    op.drop_table('hostel_fees')
    op.drop_index('ix_hostel_rooms_tenant_id', table_name='hostel_rooms')
    op.drop_table('hostel_rooms')
    op.drop_index('ix_hostel_mess_menus_tenant_id', table_name='hostel_mess_menus')
    op.drop_table('hostel_mess_menus')
    op.create_unique_constraint(None, 'attendance', ['id'])
    op.create_unique_constraint(None, 'calendar_events', ['id'])
    op.create_unique_constraint(None, 'courses', ['id'])
    op.add_column('exam_results', sa.Column('is_passed', sa.Boolean(), nullable=True))
    op.add_column('exam_results', sa.Column('rank', sa.Integer(), nullable=True))
    op.create_unique_constraint(None, 'exam_results', ['id'])
    op.create_unique_constraint(None, 'examinations', ['id'])
    op.alter_column('fee_discounts', 'tenant_id',
               existing_type=sa.UUID(),
               nullable=True)
    op.create_unique_constraint(None, 'fee_discounts', ['id'])
    op.alter_column('fee_payments', 'tenant_id',
               existing_type=sa.UUID(),
               nullable=True)
    op.create_unique_constraint(None, 'fee_payments', ['id'])
    op.alter_column('fee_structures', 'tenant_id',
               existing_type=sa.UUID(),
               nullable=True)
    op.create_unique_constraint(None, 'fee_structures', ['id'])
    op.create_unique_constraint(None, 'grade_levels', ['id'])
    op.create_unique_constraint(None, 'grade_scales', ['id'])
    op.alter_column('messages', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               nullable=False,
               existing_server_default=sa.text('CURRENT_TIMESTAMP'))
    op.alter_column('messages', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               nullable=False,
               existing_server_default=sa.text('CURRENT_TIMESTAMP'))
    op.alter_column('messages', 'is_deleted',
               existing_type=sa.BOOLEAN(),
               nullable=False,
               existing_server_default=sa.text('false'))
    op.drop_index('idx_messages_recipient', table_name='messages')
    op.drop_index('idx_messages_sender', table_name='messages')
    op.drop_index('idx_messages_status', table_name='messages')
    op.create_index(op.f('ix_messages_recipient_id'), 'messages', ['recipient_id'], unique=False)
    op.create_index(op.f('ix_messages_sender_id'), 'messages', ['sender_id'], unique=False)
    op.create_index(op.f('ix_messages_tenant_id'), 'messages', ['tenant_id'], unique=False)
    op.create_unique_constraint(None, 'messages', ['id'])
    op.create_unique_constraint(None, 'modules', ['id'])
    op.create_unique_constraint(None, 'notification_preferences', ['id'])
    op.create_unique_constraint(None, 'notification_templates', ['id'])
    op.create_unique_constraint(None, 'notifications', ['id'])
    op.create_unique_constraint(None, 'parent_students', ['id'])
    op.create_unique_constraint(None, 'payment_gateway_configs', ['id'])
    op.create_unique_constraint(None, 'payment_notifications', ['id'])
    op.create_unique_constraint(None, 'payment_orders', ['id'])
    op.create_unique_constraint(None, 'payment_refunds', ['id'])
    op.create_unique_constraint(None, 'payment_transactions', ['id'])
    op.create_unique_constraint(None, 'permissions', ['id'])
    op.alter_column('refresh_tokens', 'tenant_id',
               existing_type=sa.UUID(),
               nullable=True)
    op.create_unique_constraint(None, 'refresh_tokens', ['id'])
    op.alter_column('reports', 'report_type',
               existing_type=sa.VARCHAR(length=50),
               type_=sa.Enum('STUDENT_LIST', 'ATTENDANCE_SUMMARY', 'FEE_COLLECTION', 'FEE_DEFAULTERS', 'STAFF_LIST', 'EXAM_RESULTS', 'CUSTOM', name='reporttype'),
               existing_nullable=True,
               existing_server_default=sa.text("'custom'::character varying"))
    op.alter_column('reports', 'format',
               existing_type=sa.VARCHAR(length=20),
               type_=sa.Enum('PDF', 'EXCEL', 'CSV', 'JSON', name='reportformat'),
               existing_nullable=True,
               existing_server_default=sa.text("'json'::character varying"))
    op.alter_column('reports', 'status',
               existing_type=sa.VARCHAR(length=20),
               type_=sa.Enum('PENDING', 'PROCESSING', 'COMPLETED', 'FAILED', name='reportstatus'),
               existing_nullable=True,
               existing_server_default=sa.text("'pending'::character varying"))
    op.alter_column('reports', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               nullable=False,
               existing_server_default=sa.text('CURRENT_TIMESTAMP'))
    op.alter_column('reports', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               nullable=False,
               existing_server_default=sa.text('CURRENT_TIMESTAMP'))
    op.drop_index('idx_reports_status', table_name='reports')
    op.drop_index('idx_reports_type', table_name='reports')
    op.create_index(op.f('ix_reports_tenant_id'), 'reports', ['tenant_id'], unique=False)
    op.create_unique_constraint(None, 'reports', ['id'])
    op.drop_column('reports', 'is_deleted')
    op.drop_column('reports', 'deleted_at')
    op.create_unique_constraint(None, 'role_module_access', ['id'])
    op.create_unique_constraint(None, 'role_permissions', ['id'])
    op.alter_column('roles', 'tenant_id',
               existing_type=sa.UUID(),
               nullable=True)
    op.create_unique_constraint(None, 'roles', ['id'])
    op.create_unique_constraint(None, 'rooms', ['id'])
    op.create_unique_constraint(None, 'school_classes', ['id'])
    op.create_unique_constraint(None, 'staff', ['id'])
    op.create_unique_constraint(None, 'student_gpas', ['id'])
    op.create_unique_constraint(None, 'student_transport', ['id'])
    op.alter_column('students', 'blood_group',
               existing_type=sa.VARCHAR(length=20),
               type_=sa.String(length=10),
               existing_nullable=True)
    op.alter_column('students', 'tenant_id',
               existing_type=sa.UUID(),
               nullable=True)
    op.drop_index('ix_students_user_id', table_name='students')
    op.create_unique_constraint(None, 'students', ['id'])
    op.drop_constraint('students_user_id_fkey', 'students', type_='foreignkey')
    op.drop_column('students', 'user_id')
    op.create_unique_constraint(None, 'subscription_plans', ['id'])
    op.create_unique_constraint(None, 'tenant_modules', ['id'])
    op.create_unique_constraint(None, 'tenant_settings', ['id'])
    op.create_unique_constraint(None, 'tenants', ['id'])
    op.create_unique_constraint(None, 'time_slots', ['id'])
    op.create_unique_constraint(None, 'timetable_conflicts', ['id'])
    op.create_unique_constraint(None, 'timetable_entries', ['id'])
    op.create_unique_constraint(None, 'transport_fees', ['id'])
    op.create_unique_constraint(None, 'transport_route_stops', ['id'])
    op.create_unique_constraint(None, 'transport_routes', ['id'])
    op.create_unique_constraint(None, 'transport_vehicles', ['id'])
    op.create_unique_constraint(None, 'user_roles', ['id'])
    op.alter_column('users', 'tenant_id',
               existing_type=sa.UUID(),
               nullable=True)
    op.create_unique_constraint(None, 'users', ['id'])
    # ### end Alembic commands ###


def downgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_constraint(None, 'users', type_='unique')
    op.alter_column('users', 'tenant_id',
               existing_type=sa.UUID(),
               nullable=False)
    op.drop_constraint(None, 'user_roles', type_='unique')
    op.drop_constraint(None, 'transport_vehicles', type_='unique')
    op.drop_constraint(None, 'transport_routes', type_='unique')
    op.drop_constraint(None, 'transport_route_stops', type_='unique')
    op.drop_constraint(None, 'transport_fees', type_='unique')
    op.drop_constraint(None, 'timetable_entries', type_='unique')
    op.drop_constraint(None, 'timetable_conflicts', type_='unique')
    op.drop_constraint(None, 'time_slots', type_='unique')
    op.drop_constraint(None, 'tenants', type_='unique')
    op.drop_constraint(None, 'tenant_settings', type_='unique')
    op.drop_constraint(None, 'tenant_modules', type_='unique')
    op.drop_constraint(None, 'subscription_plans', type_='unique')
    op.add_column('students', sa.Column('user_id', sa.UUID(), autoincrement=False, nullable=True))
    op.create_foreign_key('students_user_id_fkey', 'students', 'users', ['user_id'], ['id'], ondelete='SET NULL')
    op.drop_constraint(None, 'students', type_='unique')
    op.create_index('ix_students_user_id', 'students', ['user_id'], unique=False)
    op.alter_column('students', 'tenant_id',
               existing_type=sa.UUID(),
               nullable=False)
    op.alter_column('students', 'blood_group',
               existing_type=sa.String(length=10),
               type_=sa.VARCHAR(length=20),
               existing_nullable=True)
    op.drop_constraint(None, 'student_transport', type_='unique')
    op.drop_constraint(None, 'student_gpas', type_='unique')
    op.drop_constraint(None, 'staff', type_='unique')
    op.drop_constraint(None, 'school_classes', type_='unique')
    op.drop_constraint(None, 'rooms', type_='unique')
    op.drop_constraint(None, 'roles', type_='unique')
    op.alter_column('roles', 'tenant_id',
               existing_type=sa.UUID(),
               nullable=False)
    op.drop_constraint(None, 'role_permissions', type_='unique')
    op.drop_constraint(None, 'role_module_access', type_='unique')
    op.add_column('reports', sa.Column('deleted_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=True))
    op.add_column('reports', sa.Column('is_deleted', sa.BOOLEAN(), server_default=sa.text('false'), autoincrement=False, nullable=True))
    op.drop_constraint(None, 'reports', type_='unique')
    op.drop_index(op.f('ix_reports_tenant_id'), table_name='reports')
    op.create_index('idx_reports_type', 'reports', ['report_type'], unique=False)
    op.create_index('idx_reports_status', 'reports', ['status'], unique=False)
    op.alter_column('reports', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               nullable=True,
               existing_server_default=sa.text('CURRENT_TIMESTAMP'))
    op.alter_column('reports', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               nullable=True,
               existing_server_default=sa.text('CURRENT_TIMESTAMP'))
    op.alter_column('reports', 'status',
               existing_type=sa.Enum('PENDING', 'PROCESSING', 'COMPLETED', 'FAILED', name='reportstatus'),
               type_=sa.VARCHAR(length=20),
               existing_nullable=True,
               existing_server_default=sa.text("'pending'::character varying"))
    op.alter_column('reports', 'format',
               existing_type=sa.Enum('PDF', 'EXCEL', 'CSV', 'JSON', name='reportformat'),
               type_=sa.VARCHAR(length=20),
               existing_nullable=True,
               existing_server_default=sa.text("'json'::character varying"))
    op.alter_column('reports', 'report_type',
               existing_type=sa.Enum('STUDENT_LIST', 'ATTENDANCE_SUMMARY', 'FEE_COLLECTION', 'FEE_DEFAULTERS', 'STAFF_LIST', 'EXAM_RESULTS', 'CUSTOM', name='reporttype'),
               type_=sa.VARCHAR(length=50),
               existing_nullable=True,
               existing_server_default=sa.text("'custom'::character varying"))
    op.drop_constraint(None, 'refresh_tokens', type_='unique')
    op.alter_column('refresh_tokens', 'tenant_id',
               existing_type=sa.UUID(),
               nullable=False)
    op.drop_constraint(None, 'permissions', type_='unique')
    op.drop_constraint(None, 'payment_transactions', type_='unique')
    op.drop_constraint(None, 'payment_refunds', type_='unique')
    op.drop_constraint(None, 'payment_orders', type_='unique')
    op.drop_constraint(None, 'payment_notifications', type_='unique')
    op.drop_constraint(None, 'payment_gateway_configs', type_='unique')
    op.drop_constraint(None, 'parent_students', type_='unique')
    op.drop_constraint(None, 'notifications', type_='unique')
    op.drop_constraint(None, 'notification_templates', type_='unique')
    op.drop_constraint(None, 'notification_preferences', type_='unique')
    op.drop_constraint(None, 'modules', type_='unique')
    op.drop_constraint(None, 'messages', type_='unique')
    op.drop_index(op.f('ix_messages_tenant_id'), table_name='messages')
    op.drop_index(op.f('ix_messages_sender_id'), table_name='messages')
    op.drop_index(op.f('ix_messages_recipient_id'), table_name='messages')
    op.create_index('idx_messages_status', 'messages', ['status'], unique=False)
    op.create_index('idx_messages_sender', 'messages', ['sender_id'], unique=False)
    op.create_index('idx_messages_recipient', 'messages', ['recipient_id'], unique=False)
    op.alter_column('messages', 'is_deleted',
               existing_type=sa.BOOLEAN(),
               nullable=True,
               existing_server_default=sa.text('false'))
    op.alter_column('messages', 'updated_at',
               existing_type=postgresql.TIMESTAMP(),
               nullable=True,
               existing_server_default=sa.text('CURRENT_TIMESTAMP'))
    op.alter_column('messages', 'created_at',
               existing_type=postgresql.TIMESTAMP(),
               nullable=True,
               existing_server_default=sa.text('CURRENT_TIMESTAMP'))
    op.drop_constraint(None, 'grade_scales', type_='unique')
    op.drop_constraint(None, 'grade_levels', type_='unique')
    op.drop_constraint(None, 'fee_structures', type_='unique')
    op.alter_column('fee_structures', 'tenant_id',
               existing_type=sa.UUID(),
               nullable=False)
    op.drop_constraint(None, 'fee_payments', type_='unique')
    op.alter_column('fee_payments', 'tenant_id',
               existing_type=sa.UUID(),
               nullable=False)
    op.drop_constraint(None, 'fee_discounts', type_='unique')
    op.alter_column('fee_discounts', 'tenant_id',
               existing_type=sa.UUID(),
               nullable=False)
    op.drop_constraint(None, 'examinations', type_='unique')
    op.drop_constraint(None, 'exam_results', type_='unique')
    op.drop_column('exam_results', 'rank')
    op.drop_column('exam_results', 'is_passed')
    op.drop_constraint(None, 'courses', type_='unique')
    op.drop_constraint(None, 'calendar_events', type_='unique')
    op.drop_constraint(None, 'attendance', type_='unique')
    op.create_table('hostel_mess_menus',
    sa.Column('hostel_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('day_of_week', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('menu_date', sa.DATE(), autoincrement=False, nullable=True),
    sa.Column('breakfast', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('lunch', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('dinner', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('snacks', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), autoincrement=False, nullable=True),
    sa.Column('notes', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('tenant_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.ForeignKeyConstraint(['hostel_id'], ['hostels.id'], name='hostel_mess_menus_hostel_id_fkey', ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['tenant_id'], ['tenants.id'], name='hostel_mess_menus_tenant_id_fkey', ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id', name='hostel_mess_menus_pkey')
    )
    op.create_index('ix_hostel_mess_menus_tenant_id', 'hostel_mess_menus', ['tenant_id'], unique=False)
    op.create_table('hostel_rooms',
    sa.Column('hostel_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('room_number', sa.VARCHAR(length=50), autoincrement=False, nullable=False),
    sa.Column('floor', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('block', sa.VARCHAR(length=50), autoincrement=False, nullable=True),
    sa.Column('room_type', postgresql.ENUM('SINGLE', 'DOUBLE', 'TRIPLE', 'DORMITORY', 'SUITE', name='roomtype'), autoincrement=False, nullable=True),
    sa.Column('capacity', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('occupied', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('has_attached_bathroom', sa.BOOLEAN(), autoincrement=False, nullable=True),
    sa.Column('has_ac', sa.BOOLEAN(), autoincrement=False, nullable=True),
    sa.Column('has_balcony', sa.BOOLEAN(), autoincrement=False, nullable=True),
    sa.Column('monthly_rent', sa.DOUBLE_PRECISION(precision=53), autoincrement=False, nullable=True),
    sa.Column('status', postgresql.ENUM('AVAILABLE', 'OCCUPIED', 'MAINTENANCE', 'RESERVED', name='roomstatus'), autoincrement=False, nullable=True),
    sa.Column('notes', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('extra_data', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('tenant_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('is_deleted', sa.BOOLEAN(), autoincrement=False, nullable=False),
    sa.Column('deleted_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=True),
    sa.Column('deleted_by', sa.UUID(), autoincrement=False, nullable=True),
    sa.ForeignKeyConstraint(['hostel_id'], ['hostels.id'], name='hostel_rooms_hostel_id_fkey', ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['tenant_id'], ['tenants.id'], name='hostel_rooms_tenant_id_fkey', ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id', name='hostel_rooms_pkey'),
    postgresql_ignore_search_path=False
    )
    op.create_index('ix_hostel_rooms_tenant_id', 'hostel_rooms', ['tenant_id'], unique=False)
    op.create_table('hostel_fees',
    sa.Column('student_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('allocation_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('fee_month', sa.DATE(), autoincrement=False, nullable=False),
    sa.Column('room_rent', sa.DOUBLE_PRECISION(precision=53), autoincrement=False, nullable=True),
    sa.Column('mess_charges', sa.DOUBLE_PRECISION(precision=53), autoincrement=False, nullable=True),
    sa.Column('electricity_charges', sa.DOUBLE_PRECISION(precision=53), autoincrement=False, nullable=True),
    sa.Column('other_charges', sa.DOUBLE_PRECISION(precision=53), autoincrement=False, nullable=True),
    sa.Column('discount', sa.DOUBLE_PRECISION(precision=53), autoincrement=False, nullable=True),
    sa.Column('fine', sa.DOUBLE_PRECISION(precision=53), autoincrement=False, nullable=True),
    sa.Column('total_amount', sa.DOUBLE_PRECISION(precision=53), autoincrement=False, nullable=False),
    sa.Column('amount_paid', sa.DOUBLE_PRECISION(precision=53), autoincrement=False, nullable=True),
    sa.Column('payment_date', sa.DATE(), autoincrement=False, nullable=True),
    sa.Column('payment_reference', sa.VARCHAR(length=100), autoincrement=False, nullable=True),
    sa.Column('is_paid', sa.BOOLEAN(), autoincrement=False, nullable=True),
    sa.Column('notes', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('tenant_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.ForeignKeyConstraint(['allocation_id'], ['hostel_room_allocations.id'], name='hostel_fees_allocation_id_fkey', ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['student_id'], ['students.id'], name='hostel_fees_student_id_fkey', ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['tenant_id'], ['tenants.id'], name='hostel_fees_tenant_id_fkey', ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id', name='hostel_fees_pkey')
    )
    op.create_index('ix_hostel_fees_tenant_id', 'hostel_fees', ['tenant_id'], unique=False)
    op.create_table('library_book_copies',
    sa.Column('book_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('barcode', sa.VARCHAR(length=50), autoincrement=False, nullable=False),
    sa.Column('copy_number', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('condition', postgresql.ENUM('NEW', 'EXCELLENT', 'GOOD', 'FAIR', 'POOR', 'DAMAGED', 'LOST', name='bookcondition'), autoincrement=False, nullable=True),
    sa.Column('is_available', sa.BOOLEAN(), autoincrement=False, nullable=True),
    sa.Column('is_reference_only', sa.BOOLEAN(), autoincrement=False, nullable=True),
    sa.Column('rack_number', sa.VARCHAR(length=50), autoincrement=False, nullable=True),
    sa.Column('shelf_number', sa.VARCHAR(length=50), autoincrement=False, nullable=True),
    sa.Column('acquisition_date', sa.DATE(), autoincrement=False, nullable=True),
    sa.Column('acquisition_source', sa.VARCHAR(length=200), autoincrement=False, nullable=True),
    sa.Column('acquisition_price', sa.DOUBLE_PRECISION(precision=53), autoincrement=False, nullable=True),
    sa.Column('notes', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('tenant_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.ForeignKeyConstraint(['book_id'], ['library_books.id'], name='library_book_copies_book_id_fkey', ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['tenant_id'], ['tenants.id'], name='library_book_copies_tenant_id_fkey', ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id', name='library_book_copies_pkey'),
    sa.UniqueConstraint('tenant_id', 'barcode', name='uq_book_copy_barcode'),
    postgresql_ignore_search_path=False
    )
    op.create_index('ix_library_book_copies_tenant_id', 'library_book_copies', ['tenant_id'], unique=False)
    op.create_index('ix_library_book_copies_barcode', 'library_book_copies', ['barcode'], unique=False)
    op.create_table('library_settings',
    sa.Column('default_issue_days', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('max_renewals', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('fine_per_day', sa.DOUBLE_PRECISION(precision=53), autoincrement=False, nullable=True),
    sa.Column('fine_on_sunday', sa.BOOLEAN(), autoincrement=False, nullable=True),
    sa.Column('fine_on_holidays', sa.BOOLEAN(), autoincrement=False, nullable=True),
    sa.Column('max_fine_per_book', sa.DOUBLE_PRECISION(precision=53), autoincrement=False, nullable=True),
    sa.Column('student_max_books', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('staff_max_books', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('faculty_max_books', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('send_due_reminders', sa.BOOLEAN(), autoincrement=False, nullable=True),
    sa.Column('reminder_days_before', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('send_overdue_alerts', sa.BOOLEAN(), autoincrement=False, nullable=True),
    sa.Column('working_hours', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('tenant_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.ForeignKeyConstraint(['tenant_id'], ['tenants.id'], name='library_settings_tenant_id_fkey', ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id', name='library_settings_pkey')
    )
    op.create_index('ix_library_settings_tenant_id', 'library_settings', ['tenant_id'], unique=False)
    op.create_table('hostel_beds',
    sa.Column('room_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('bed_number', sa.VARCHAR(length=20), autoincrement=False, nullable=False),
    sa.Column('bed_type', sa.VARCHAR(length=50), autoincrement=False, nullable=True),
    sa.Column('status', postgresql.ENUM('VACANT', 'OCCUPIED', 'RESERVED', 'MAINTENANCE', name='bedstatus'), autoincrement=False, nullable=True),
    sa.Column('current_student_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('notes', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('tenant_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.ForeignKeyConstraint(['current_student_id'], ['students.id'], name='hostel_beds_current_student_id_fkey', ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['room_id'], ['hostel_rooms.id'], name='hostel_beds_room_id_fkey', ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['tenant_id'], ['tenants.id'], name='hostel_beds_tenant_id_fkey', ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id', name='hostel_beds_pkey'),
    postgresql_ignore_search_path=False
    )
    op.create_index('ix_hostel_beds_tenant_id', 'hostel_beds', ['tenant_id'], unique=False)
    op.create_table('library_books',
    sa.Column('isbn', sa.VARCHAR(length=20), autoincrement=False, nullable=True),
    sa.Column('isbn13', sa.VARCHAR(length=17), autoincrement=False, nullable=True),
    sa.Column('accession_number', sa.VARCHAR(length=50), autoincrement=False, nullable=True),
    sa.Column('title', sa.VARCHAR(length=500), autoincrement=False, nullable=False),
    sa.Column('subtitle', sa.VARCHAR(length=500), autoincrement=False, nullable=True),
    sa.Column('author', sa.VARCHAR(length=300), autoincrement=False, nullable=False),
    sa.Column('co_authors', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('publisher', sa.VARCHAR(length=200), autoincrement=False, nullable=True),
    sa.Column('publication_year', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('edition', sa.VARCHAR(length=50), autoincrement=False, nullable=True),
    sa.Column('language', sa.VARCHAR(length=50), autoincrement=False, nullable=True),
    sa.Column('category', postgresql.ENUM('FICTION', 'NON_FICTION', 'TEXTBOOK', 'REFERENCE', 'MAGAZINE', 'JOURNAL', 'NEWSPAPER', 'RESEARCH', 'CHILDREN', 'BIOGRAPHY', 'HISTORY', 'SCIENCE', 'TECHNOLOGY', 'ARTS', 'OTHER', name='bookcategory'), autoincrement=False, nullable=True),
    sa.Column('subject', sa.VARCHAR(length=200), autoincrement=False, nullable=True),
    sa.Column('keywords', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('pages', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('binding', sa.VARCHAR(length=50), autoincrement=False, nullable=True),
    sa.Column('rack_number', sa.VARCHAR(length=50), autoincrement=False, nullable=True),
    sa.Column('shelf_number', sa.VARCHAR(length=50), autoincrement=False, nullable=True),
    sa.Column('price', sa.DOUBLE_PRECISION(precision=53), autoincrement=False, nullable=True),
    sa.Column('description', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('cover_image_url', sa.VARCHAR(length=500), autoincrement=False, nullable=True),
    sa.Column('total_copies', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('available_copies', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('extra_data', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('tenant_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('is_deleted', sa.BOOLEAN(), autoincrement=False, nullable=False),
    sa.Column('deleted_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=True),
    sa.Column('deleted_by', sa.UUID(), autoincrement=False, nullable=True),
    sa.ForeignKeyConstraint(['tenant_id'], ['tenants.id'], name='library_books_tenant_id_fkey', ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id', name='library_books_pkey'),
    sa.UniqueConstraint('tenant_id', 'isbn', name='uq_book_isbn'),
    sa.UniqueConstraint('tenant_id', 'isbn13', name='uq_book_isbn13'),
    postgresql_ignore_search_path=False
    )
    op.create_index('ix_library_books_title', 'library_books', ['title'], unique=False)
    op.create_index('ix_library_books_tenant_id', 'library_books', ['tenant_id'], unique=False)
    op.create_index('ix_library_books_isbn13', 'library_books', ['isbn13'], unique=False)
    op.create_index('ix_library_books_isbn', 'library_books', ['isbn'], unique=False)
    op.create_index('ix_library_books_author', 'library_books', ['author'], unique=False)
    op.create_index('ix_library_books_accession_number', 'library_books', ['accession_number'], unique=False)
    op.create_table('hostels',
    sa.Column('name', sa.VARCHAR(length=200), autoincrement=False, nullable=False),
    sa.Column('code', sa.VARCHAR(length=50), autoincrement=False, nullable=True),
    sa.Column('hostel_type', postgresql.ENUM('BOYS', 'GIRLS', 'CO_ED', 'STAFF', name='hosteltype'), autoincrement=False, nullable=True),
    sa.Column('description', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('address', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('landmark', sa.VARCHAR(length=200), autoincrement=False, nullable=True),
    sa.Column('warden_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('contact_phone', sa.VARCHAR(length=20), autoincrement=False, nullable=True),
    sa.Column('contact_email', sa.VARCHAR(length=100), autoincrement=False, nullable=True),
    sa.Column('total_rooms', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('total_beds', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('facilities', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('check_in_time', postgresql.TIME(), autoincrement=False, nullable=True),
    sa.Column('check_out_time', postgresql.TIME(), autoincrement=False, nullable=True),
    sa.Column('curfew_time', postgresql.TIME(), autoincrement=False, nullable=True),
    sa.Column('security_deposit', sa.DOUBLE_PRECISION(precision=53), autoincrement=False, nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), autoincrement=False, nullable=True),
    sa.Column('notes', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('extra_data', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('tenant_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('is_deleted', sa.BOOLEAN(), autoincrement=False, nullable=False),
    sa.Column('deleted_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=True),
    sa.Column('deleted_by', sa.UUID(), autoincrement=False, nullable=True),
    sa.ForeignKeyConstraint(['tenant_id'], ['tenants.id'], name='hostels_tenant_id_fkey', ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['warden_id'], ['staff.id'], name='hostels_warden_id_fkey', ondelete='SET NULL'),
    sa.PrimaryKeyConstraint('id', name='hostels_pkey'),
    postgresql_ignore_search_path=False
    )
    op.create_index('ix_hostels_tenant_id', 'hostels', ['tenant_id'], unique=False)
    op.create_index('ix_hostels_code', 'hostels', ['code'], unique=False)
    op.create_table('hostel_room_allocations',
    sa.Column('student_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('room_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('bed_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('academic_year', sa.VARCHAR(length=20), autoincrement=False, nullable=True),
    sa.Column('check_in_date', sa.DATE(), autoincrement=False, nullable=True),
    sa.Column('expected_checkout_date', sa.DATE(), autoincrement=False, nullable=True),
    sa.Column('actual_checkout_date', sa.DATE(), autoincrement=False, nullable=True),
    sa.Column('monthly_rent', sa.DOUBLE_PRECISION(precision=53), autoincrement=False, nullable=True),
    sa.Column('security_deposit', sa.DOUBLE_PRECISION(precision=53), autoincrement=False, nullable=True),
    sa.Column('deposit_paid', sa.BOOLEAN(), autoincrement=False, nullable=True),
    sa.Column('deposit_refunded', sa.BOOLEAN(), autoincrement=False, nullable=True),
    sa.Column('status', postgresql.ENUM('ACTIVE', 'CHECKED_OUT', 'CANCELLED', 'PENDING', name='allocationstatus'), autoincrement=False, nullable=True),
    sa.Column('notes', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('extra_data', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('tenant_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.ForeignKeyConstraint(['bed_id'], ['hostel_beds.id'], name='hostel_room_allocations_bed_id_fkey', ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['room_id'], ['hostel_rooms.id'], name='hostel_room_allocations_room_id_fkey', ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['student_id'], ['students.id'], name='hostel_room_allocations_student_id_fkey', ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['tenant_id'], ['tenants.id'], name='hostel_room_allocations_tenant_id_fkey', ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id', name='hostel_room_allocations_pkey')
    )
    op.create_index('ix_hostel_room_allocations_tenant_id', 'hostel_room_allocations', ['tenant_id'], unique=False)
    op.create_table('library_members',
    sa.Column('member_code', sa.VARCHAR(length=50), autoincrement=False, nullable=False),
    sa.Column('user_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('student_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('staff_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('member_type', postgresql.ENUM('STUDENT', 'STAFF', 'FACULTY', 'GUEST', name='membertype'), autoincrement=False, nullable=True),
    sa.Column('name', sa.VARCHAR(length=200), autoincrement=False, nullable=False),
    sa.Column('email', sa.VARCHAR(length=255), autoincrement=False, nullable=True),
    sa.Column('phone', sa.VARCHAR(length=20), autoincrement=False, nullable=True),
    sa.Column('membership_start', sa.DATE(), autoincrement=False, nullable=True),
    sa.Column('membership_end', sa.DATE(), autoincrement=False, nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), autoincrement=False, nullable=True),
    sa.Column('max_books', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('max_days', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('total_fines', sa.DOUBLE_PRECISION(precision=53), autoincrement=False, nullable=True),
    sa.Column('fines_paid', sa.DOUBLE_PRECISION(precision=53), autoincrement=False, nullable=True),
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('tenant_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.ForeignKeyConstraint(['staff_id'], ['staff.id'], name='library_members_staff_id_fkey', ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['student_id'], ['students.id'], name='library_members_student_id_fkey', ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['tenant_id'], ['tenants.id'], name='library_members_tenant_id_fkey', ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], name='library_members_user_id_fkey', ondelete='SET NULL'),
    sa.PrimaryKeyConstraint('id', name='library_members_pkey'),
    sa.UniqueConstraint('tenant_id', 'member_code', name='uq_library_member_code'),
    postgresql_ignore_search_path=False
    )
    op.create_index('ix_library_members_tenant_id', 'library_members', ['tenant_id'], unique=False)
    op.create_index('ix_library_members_member_code', 'library_members', ['member_code'], unique=False)
    op.create_table('audit_logs',
    sa.Column('tenant_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('user_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('user_email', sa.VARCHAR(length=255), autoincrement=False, nullable=True),
    sa.Column('action', postgresql.ENUM('CREATE', 'READ', 'UPDATE', 'DELETE', 'LOGIN', 'LOGOUT', 'FAILED_LOGIN', 'PASSWORD_CHANGE', 'PERMISSION_CHANGE', 'EXPORT', 'IMPORT', name='auditaction'), autoincrement=False, nullable=False),
    sa.Column('resource_type', sa.VARCHAR(length=100), autoincrement=False, nullable=False),
    sa.Column('resource_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('resource_name', sa.VARCHAR(length=255), autoincrement=False, nullable=True),
    sa.Column('old_value', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('new_value', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('changes', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('ip_address', sa.VARCHAR(length=45), autoincrement=False, nullable=True),
    sa.Column('user_agent', sa.VARCHAR(length=500), autoincrement=False, nullable=True),
    sa.Column('request_id', sa.VARCHAR(length=50), autoincrement=False, nullable=True),
    sa.Column('extra_data', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('timestamp', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.ForeignKeyConstraint(['tenant_id'], ['tenants.id'], name='audit_logs_tenant_id_fkey'),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], name='audit_logs_user_id_fkey'),
    sa.PrimaryKeyConstraint('id', name='audit_logs_pkey')
    )
    op.create_index('ix_audit_logs_user_id', 'audit_logs', ['user_id'], unique=False)
    op.create_index('ix_audit_logs_timestamp', 'audit_logs', ['timestamp'], unique=False)
    op.create_index('ix_audit_logs_tenant_id', 'audit_logs', ['tenant_id'], unique=False)
    op.create_index('ix_audit_logs_resource_type', 'audit_logs', ['resource_type'], unique=False)
    op.create_index('ix_audit_logs_resource_id', 'audit_logs', ['resource_id'], unique=False)
    op.create_index('ix_audit_logs_action', 'audit_logs', ['action'], unique=False)
    op.create_table('certificates',
    sa.Column('certificate_number', sa.VARCHAR(length=50), autoincrement=False, nullable=False),
    sa.Column('verification_code', sa.VARCHAR(length=50), autoincrement=False, nullable=False),
    sa.Column('template_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('certificate_type', postgresql.ENUM('BONAFIDE', 'TRANSFER', 'CHARACTER', 'COURSE_COMPLETION', 'MERIT', 'PARTICIPATION', 'ACHIEVEMENT', 'CONDUCT', 'STUDY', 'CUSTOM', name='certificatetype'), autoincrement=False, nullable=False),
    sa.Column('student_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('title', sa.VARCHAR(length=255), autoincrement=False, nullable=False),
    sa.Column('description', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('certificate_data', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('rendered_html', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('pdf_url', sa.VARCHAR(length=500), autoincrement=False, nullable=True),
    sa.Column('pdf_generated_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=True),
    sa.Column('status', postgresql.ENUM('DRAFT', 'PENDING_APPROVAL', 'APPROVED', 'ISSUED', 'REVOKED', 'EXPIRED', name='certificatestatus'), autoincrement=False, nullable=True),
    sa.Column('requested_by_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('approved_by_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('approved_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=True),
    sa.Column('issued_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=True),
    sa.Column('issued_by_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('valid_from', postgresql.TIMESTAMP(), autoincrement=False, nullable=True),
    sa.Column('valid_until', postgresql.TIMESTAMP(), autoincrement=False, nullable=True),
    sa.Column('revoked_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=True),
    sa.Column('revoked_by_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('revocation_reason', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('download_count', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('last_downloaded_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=True),
    sa.Column('verification_count', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('last_verified_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=True),
    sa.Column('extra_data', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('tenant_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.ForeignKeyConstraint(['approved_by_id'], ['users.id'], name='certificates_approved_by_id_fkey'),
    sa.ForeignKeyConstraint(['issued_by_id'], ['users.id'], name='certificates_issued_by_id_fkey'),
    sa.ForeignKeyConstraint(['requested_by_id'], ['users.id'], name='certificates_requested_by_id_fkey'),
    sa.ForeignKeyConstraint(['revoked_by_id'], ['users.id'], name='certificates_revoked_by_id_fkey'),
    sa.ForeignKeyConstraint(['student_id'], ['students.id'], name='certificates_student_id_fkey'),
    sa.ForeignKeyConstraint(['template_id'], ['certificate_templates.id'], name='certificates_template_id_fkey'),
    sa.ForeignKeyConstraint(['tenant_id'], ['tenants.id'], name='certificates_tenant_id_fkey', ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id', name='certificates_pkey'),
    sa.UniqueConstraint('tenant_id', 'certificate_number', name='uq_certificate_tenant_number')
    )
    op.create_index('ix_certificates_verification_code', 'certificates', ['verification_code'], unique=True)
    op.create_index('ix_certificates_tenant_id', 'certificates', ['tenant_id'], unique=False)
    op.create_index('ix_certificates_student_id', 'certificates', ['student_id'], unique=False)
    op.create_index('ix_certificates_status', 'certificates', ['status'], unique=False)
    op.create_index('ix_certificates_certificate_type', 'certificates', ['certificate_type'], unique=False)
    op.create_index('ix_certificates_certificate_number', 'certificates', ['certificate_number'], unique=False)
    op.create_table('library_book_issues',
    sa.Column('book_copy_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('member_id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('issue_date', sa.DATE(), autoincrement=False, nullable=False),
    sa.Column('due_date', sa.DATE(), autoincrement=False, nullable=False),
    sa.Column('return_date', sa.DATE(), autoincrement=False, nullable=True),
    sa.Column('status', postgresql.ENUM('ISSUED', 'RETURNED', 'OVERDUE', 'LOST', 'RENEWED', name='issuestatus'), autoincrement=False, nullable=True),
    sa.Column('renewal_count', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('max_renewals', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('fine_amount', sa.DOUBLE_PRECISION(precision=53), autoincrement=False, nullable=True),
    sa.Column('fine_paid', sa.BOOLEAN(), autoincrement=False, nullable=True),
    sa.Column('fine_per_day', sa.DOUBLE_PRECISION(precision=53), autoincrement=False, nullable=True),
    sa.Column('issued_by_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('returned_to_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('condition_at_issue', postgresql.ENUM('NEW', 'EXCELLENT', 'GOOD', 'FAIR', 'POOR', 'DAMAGED', 'LOST', name='bookcondition'), autoincrement=False, nullable=True),
    sa.Column('condition_at_return', postgresql.ENUM('NEW', 'EXCELLENT', 'GOOD', 'FAIR', 'POOR', 'DAMAGED', 'LOST', name='bookcondition'), autoincrement=False, nullable=True),
    sa.Column('notes', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('tenant_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.ForeignKeyConstraint(['book_copy_id'], ['library_book_copies.id'], name='library_book_issues_book_copy_id_fkey', ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['issued_by_id'], ['users.id'], name='library_book_issues_issued_by_id_fkey', ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['member_id'], ['library_members.id'], name='library_book_issues_member_id_fkey', ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['returned_to_id'], ['users.id'], name='library_book_issues_returned_to_id_fkey', ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['tenant_id'], ['tenants.id'], name='library_book_issues_tenant_id_fkey', ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id', name='library_book_issues_pkey')
    )
    op.create_index('ix_library_book_issues_tenant_id', 'library_book_issues', ['tenant_id'], unique=False)
    op.create_table('certificate_templates',
    sa.Column('code', sa.VARCHAR(length=100), autoincrement=False, nullable=False),
    sa.Column('name', sa.VARCHAR(length=255), autoincrement=False, nullable=False),
    sa.Column('description', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('certificate_type', postgresql.ENUM('BONAFIDE', 'TRANSFER', 'CHARACTER', 'COURSE_COMPLETION', 'MERIT', 'PARTICIPATION', 'ACHIEVEMENT', 'CONDUCT', 'STUDY', 'CUSTOM', name='certificatetype'), autoincrement=False, nullable=False),
    sa.Column('html_template', sa.TEXT(), autoincrement=False, nullable=False),
    sa.Column('css_styles', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('page_size', sa.VARCHAR(length=20), autoincrement=False, nullable=True),
    sa.Column('orientation', sa.VARCHAR(length=20), autoincrement=False, nullable=True),
    sa.Column('margins', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('header_html', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('footer_html', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('background_image_url', sa.VARCHAR(length=500), autoincrement=False, nullable=True),
    sa.Column('watermark_text', sa.VARCHAR(length=100), autoincrement=False, nullable=True),
    sa.Column('signature_positions', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('variables', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('sample_data', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('is_active', sa.BOOLEAN(), autoincrement=False, nullable=True),
    sa.Column('is_default', sa.BOOLEAN(), autoincrement=False, nullable=True),
    sa.Column('id', sa.UUID(), autoincrement=False, nullable=False),
    sa.Column('tenant_id', sa.UUID(), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.ForeignKeyConstraint(['tenant_id'], ['tenants.id'], name='certificate_templates_tenant_id_fkey', ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id', name='certificate_templates_pkey'),
    sa.UniqueConstraint('tenant_id', 'code', name='uq_certificate_template_tenant_code')
    )
    op.create_index('ix_certificate_templates_tenant_id', 'certificate_templates', ['tenant_id'], unique=False)
    op.create_index('ix_certificate_templates_code', 'certificate_templates', ['code'], unique=False)
    op.create_index('ix_certificate_templates_certificate_type', 'certificate_templates', ['certificate_type'], unique=False)
    # ### end Alembic commands ###
